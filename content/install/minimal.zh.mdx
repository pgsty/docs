---
title: 精简安装
description: 使用最少依赖安装 PostgreSQL
icon: Download
---

import { Step, Steps } from 'fumadocs-ui/components/steps';

如果您只想要高可用 PostgreSQL 本身，而不需要监控、基础设施等功能，请考虑精简安装。

没有 [**`INFRA`**](/zh/infra/) 模块，没有监控，没有 [**本地仓库**](/zh/admin/repo)，只有 [**`ETCD`**](/zh/etcd/) 和 [**`PGSQL`**](/zh/pgsql/) 以及部分 [**`NODE`**](/zh/node/) 功能


------

## 概述 [#overview]

使用精简安装，您需要：

<Steps>
    <Step>
      使用 `slim.yml` 配置模板（`configure -c slim`）
    </Step>

    <Step>
      运行 `slim.yml` 剧本而不是 `install.yml`
    </Step>
</Steps>

```bash
curl https://repo.pigsty.cc/get | bash
./configure -c slim
./install.yml
```


精简安装只安装这些核心组件：

|     组件      |                         必需性                         | 描述                                |
|:-----------:|:---------------------------------------------------:|-----------------------------------|
|   patroni   | <span className="text-red-500 font-black">必需</span> | 引导高可用 PostgreSQL 集群               |
|    etcd     | <span className="text-red-500 font-black">必需</span> | Patroni 的元数据库依赖（DCS）              |
|  pgbouncer  | <span className="text-blue-500 font-bold">可选</span> | PostgreSQL 连接池                    |
| vip-manager | <span className="text-blue-500 font-bold">可选</span> | L2 VIP 绑定到 PostgreSQL 集群主节点       |
|   haproxy   | <span className="text-blue-500 font-bold">可选</span> | 自动路由 [**服务**](/zh/pgsql/service/) |
|   chronyd   | <span className="text-blue-500 font-bold">可选</span> | 与 NTP 服务器的时间同步                    |
|    tuned    | <span className="text-blue-500 font-bold">可选</span> | 节点调优模板和内核参数管理                     |

您可以关闭可选组件，只有两个必需组件是 `patroni` 和 `etcd`。

软件包直接从互联网上游仓库安装，[**离线安装**](/zh/install/offline) 在此处不适用。


------

## 配置 [#configure]

精简安装的配置文件示例：[`conf/slim.yml`](https://github.com/pgsty/pigsty/blob/main/conf/slim.yml)：

```yaml
all:
  children:
    infra: { hosts: { 10.10.10.10: { infra_seq: 1 }} ,vars: { repo_enabled: false }}
    etcd:  { hosts: { 10.10.10.10: { etcd_seq: 1  }} ,vars: { etcd_cluster: etcd  }}

    #----------------------------------------------#
    # PostgreSQL Cluster
    #----------------------------------------------#
    pg-meta:
      hosts:
        10.10.10.10: { pg_seq: 1, pg_role: primary }
      vars:
        pg_cluster: pg-meta
        pg_users:
          - { name: dbuser_meta ,password: DBUser.Meta   ,pgbouncer: true ,roles: [dbrole_admin   ] ,comment: pigsty admin user }
          - { name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly] ,comment: read-only viewer  }
        pg_databases:
          - { name: meta, baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions: [ vector ]}
        pg_hba_rules:
          - { user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title: 'allow grafana dashboard access cmdb from infra nodes' }
        node_crontab: [ '00 01 * * * postgres /pg/bin/pg-backup full' ] # make a full backup every 1am

  vars:
    #----------------------------------------------#
    # INFRA : https://doc.pgsty.com/infra/param
    #----------------------------------------------#
    version: v3.7.0                   # pigsty version string
    admin_ip: 10.10.10.10             # admin node ip address
    region: default                   # upstream mirror region: default,china,europe
    infra_portal:                     # domain names and upstream servers
      home         : { domain: h.pigsty }
      grafana      : { domain: g.pigsty ,endpoint: "${admin_ip}:3000" , websocket: true }
      prometheus   : { domain: p.pigsty ,endpoint: "${admin_ip}:9058" }
      alertmanager : { domain: a.pigsty ,endpoint: "${admin_ip}:9059" }
      blackbox     : { endpoint: "${admin_ip}:9115" }
      loki         : { endpoint: "${admin_ip}:3100" }

    #----------------------------------------------#
    # NODE : https://doc.pgsty.com/node/param
    #----------------------------------------------#
    nodename_overwrite: false           # do not overwrite node hostname on single node mode
    node_repo_modules: node,infra,pgsql # add these repos directly to the singleton node
    node_tune: oltp                     # node tuning specs: oltp,olap,tiny,crit

    #----------------------------------------------#
    # PGSQL : https://doc.pgsty.com/pgsql/param
    #----------------------------------------------#
    pg_version: 17                      # Default PostgreSQL Major Version is 17
    pg_conf: oltp.yml                   # pgsql tuning specs: {oltp,olap,tiny,crit}.yml
    pg_packages: [ pgsql-main, pgsql-common ]   # pg kernel and common utils
    #pg_extensions: [pg17-time ,pg17-gis ,pg17-rag ,pg17-fts ,pg17-feat ,pg17-lang ,pg17-type ,pg17-util ,pg17-func ,pg17-admin ,pg17-stat ,pg17-sec ,pg17-fdw ,pg17-sim ,pg17-etl ,pg17-olap]

    #----------------------------------------------#
    # SLIM: http://localhost:3000/docs/install/minimal
    #----------------------------------------------#
    nginx_enabled: false              # nginx not exists
    dns_enabled: false                # dnsmasq not exists
    prometheus_enabled: false         # prometheus not exists
    grafana_enabled: false            # grafana not exists
    pg_exporter_enabled: false        # disable pg_exporter
    pgbouncer_exporter_enabled: false # disable pgbouncer_exporter
    pgbackrest_exporter_enabled: false # disable pgbackrest_exporter
    pg_vip_enabled: false             # disable pg_vip
```


------

## 安装 [#install]

使用 [`slim.yml`](https://github.com/pgsty/pigsty/blob/main/slim.yml) 剧本而不是 [`install.yml`](https://github.com/pgsty/pigsty/blob/main/install.yml) 剧本：

```bash
./slim.yml
```

<Callout type="warn" title="不要使用 install.yml 进行精简安装">

    这个 `slim.yml` 剧本是专门用来在精简安装场景中取代默认 `install.yml` 剧本的。

</Callout>